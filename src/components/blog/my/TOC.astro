---
const { headings } = Astro.props;

// 헤딩 깊이에 따라 글자 크기를 살짝 차등 적용
const headingTextClass = (depth: number) => {
  if (depth <= 1) return 'text-base font-semibold';
  if (depth === 2) return 'text-sm font-medium';
  if (depth === 3) return 'text-xs font-medium';
  return 'text-[11px]';
};

const indentClass = (depth: number) => (depth > 1 ? 'border-l border-slate-200 dark:border-slate-700 pl-3' : '');
const indentStyle = (depth: number) => `margin-left:${Math.max(0, depth - 1) * 8}px`;
---

{
  headings.length > 0 && (
    <>
      {/* PC: 본문 왼쪽에 고정 (중앙에서 너무 멀지 않게) */}
      <aside class="hidden lg:block fixed top-32 right-[max(1rem,calc(50%-45rem))] w-72 text-sm z-30">
        <details class="sticky top-32 bg-white/90 dark:bg-zinc-900/90 backdrop-blur border p-4 rounded-xl shadow-lg" open>
          <summary class="flex items-center justify-between cursor-pointer select-none">
            <span class="font-semibold">목차</span>
            <span class="text-xs text-slate-500">접기</span>
          </summary>
          <ul class="space-y-1 mt-2">
            {headings.map((h) => (
              <li class={`transition-colors ${indentClass(h.depth)}`} style={indentStyle(h.depth)}>
                <a href={`#${h.slug}`} class={`hover:underline block leading-snug ${headingTextClass(h.depth)}`}>
                  {h.text}
                </a>
              </li>
            ))}
          </ul>
        </details>
      </aside>

      {/* Mobile: 우측 상단 floating button */}
      <div class="lg:hidden fixed top-20 right-4 z-50">
        <details class="relative">
          <summary class="cursor-pointer p-2 rounded-full bg-white dark:bg-zinc-800 shadow border text-sm">📑</summary>
          <div class="absolute right-0 mt-2 w-72 max-h-[70vh] overflow-y-auto bg-white dark:bg-zinc-900 shadow-lg border rounded-xl p-4 text-sm">
            <div class="flex items-center justify-between mb-2">
              <p class="font-semibold">목차</p>
              <span class="text-xs text-slate-500">접기</span>
            </div>
            <ul class="space-y-1">
              {headings.map((h) => (
                <li class={`transition-colors ${indentClass(h.depth)}`} style={indentStyle(h.depth)}>
                  <a href={`#${h.slug}`} class={`hover:underline block leading-snug ${headingTextClass(h.depth)}`}>
                    {h.text}
                  </a>
                </li>
              ))}
            </ul>
          </div>
        </details>
      </div>
    </>
  )
}
